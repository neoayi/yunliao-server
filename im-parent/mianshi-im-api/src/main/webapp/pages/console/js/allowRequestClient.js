var page=0;var sum=0;layui.use(['form','layer','laydate','table','laytpl'],function(){    var form = layui.form,        layer = parent.layer === undefined ? layui.layer : top.layer,        $ = layui.jquery,        laydate = layui.laydate,        laytpl = layui.laytpl,        table = layui.table;    // 绑定列表    var tableIns = table.render({        elem: '#allow_client_table'        ,url:request("/allowRequest/list")        ,toolbar: '#toolbar'        ,page: true        ,curr: 0        ,limit:Common.limit        ,limits:Common.limits        ,groups: 7        ,cols: [[ //表头            {field: 'id', title: '编号',width:'13%'}            ,{field: 'ip', title: 'IP地址',width:'13%'}            ,{field: 'status', title: '状态', width:'13%',templet : function (d) {                    return (d.status==1?"正常":"禁用");                }}            ,{field: 'desc', title: '描述', width:'13%'}            ,{field: 'modifTime', title: '更新时间', width:'13%',templet : function (d) {                    return UI.getLocalTime(d.modifTime);                }}            ,{field: 'createTime', title: '创建时间', width:'13%',templet : function (d) {                    return UI.getLocalTime(d.createTime);                }}            ,{fixed: 'right',title:"操作", align:'left', width:'10%', toolbar: '#bindingSDKListBar'}        ]]        ,done:function(res, curr, count){            checkRequst(res);            //获取当前每页大小            var recodeLimit = $(".layui-laypage-limits").find("option:selected").val();            if (undefined != recodeLimit){                //获取零时保留的值                var last_value = Common.getValueForElement("#binding_limlt");                //设置零时保留的值                $("#binding_limlt").val(recodeLimit);                //判断是否改变了每页大小数                if (last_value != recodeLimit){                    // 刷新                    table.reload("allow_client_table",{                        url:request("/console/getSdkLoginInfoList"),                        page: {                            curr: 1 //重新从第 1 页开始                        }                    })                }            }            if(localStorage.getItem("role")==1){                $(".delete").hide();            }            //权限判断            var arr = ['allowRequestClient-add', 'allowRequestClient-edit', 'allowRequestClient-delete'];            manage.authButton(arr);        }    });    //搜索用户    $(".search_word").on("click",function(){        table.reload("allow_client_table",{            url:request('/allowRequest/list'),            page: {                curr: 1 //重新从第 1 页开始            },            where: {                keyword : Common.getValueForElement(".ipWord"),            },        })    });    //列表操作    table.on('tool(allow_client_table)', function(obj){        var layEvent = obj.event,            data = obj.data;        if(layEvent === 'delete'){            // 删除            layer.confirm('确定删除该数据',{icon:3, title:'提示消息',yes:function () {                    layer.closeAll();                    allowClient.delete(data.id);                    obj.del();                }});        }else if (layEvent === 'update'){            //修改            allowClient.showUpdateData(data)        }    });    //首页搜索    $(".search_bindingSDK").on("click",function(){        table.reload("allow_client_table",{            where: {                userId : Common.getValueForElement(".bindingSDK_keyword") //搜索的关键字            },            page: {                curr: 1 //重新从第 1 页开始            }        })        $(".bindingSDK_keyword").val("");    });});//重新渲染表单function renderTable(){    layui.use('table', function(){        var table = layui.table;//高版本建议把括号去掉，有的低版本，需要加()        table.reload("allow_client_table");    });}var allowClient={    // 删除第三方绑定    delete:function(id){        Common.invoke({            url:request('/allowRequest/delete'),            data:{                id:id            },            success:function(result){                if(result.resultCode==1)                    layer.msg("删除成功",{icon:1});                renderTable();            }        })    },    saveAllowRequestClient:function () {        layer.open({            type: 1,            title: "新 增",            btn: ['确定', '取消'],            area: ['480px','290px'],            shadeClose: true,            offset: 'auto',            shade: [0.5, '#393D49'],            content: $(".saveAllowClient"),            success:function(){                $(".allowIdDiv").hide();                $(".allowIp").val('');                $(".allowStatus").val('');                $(".allowDesc").val('');                layui.form.render();            },            yes: function(index, layero){                var ip = $(".allowIp").val();                var status = $(".allowStatus").val();                var desc = $(".allowDesc").val();                if (Common.isNil(ip)){                    layer.msg("请输入IP",{icon: 2});                    return;                }else if (Common.isNil(status)){                    layer.msg("请选择状态",{icon: 2});                    return;                }else  if (Common.isNil(desc)){                    layer.msg("请选择描述",{icon: 2});                    return;                }                Common.invoke({                    url:request('/allowRequest/save'),                    data:{                        ip:ip,                        status:status,                        desc:desc,                    },                    success:function(result){                        if(result.resultCode==1){                            layer.msg("新增成功！",{icon: 1,time: 2000});                            renderTable();                            layui.layer.close(index);                        }                    }                })            }        });    }    ,showUpdateData:function (data) {        layer.open({            type: 1,            title: "修 改",            btn: ['确定', '取消'],            area: ['470px','338px'],            shadeClose: true,            offset: 'auto',            shade: [0.5, '#393D49'],            content: $(".saveAllowClient"),            success:function(){                $(".allowIdDiv").show();                $(".allowId").val(data.id);                $(".allowIp").val(data.ip);                $(".allowStatus").val(data.status);                $(".allowDesc").val(data.desc);                layui.form.render();            },            yes: function(index, layero){                var ip = $(".allowIp").val();                var status = $(".allowStatus").val();                var desc = $(".allowDesc").val();                if (Common.isNil(ip)){                    layer.msg("请输入IP",{icon: 2});                    return;                }else  if (Common.isNil(status)){                    layer.msg("请选择状态",{icon: 2});                    return;                }else  if (Common.isNil(desc)){                    layer.msg("请选择描述",{icon: 2});                    return;                }                Common.invoke({                    url:request('/allowRequest/update'),                    data:{                        id:$(".allowId").val(),                        ip:ip,                        status:status,                        desc:desc,                    },                    success:function(result){                        if(result.resultCode==1){                            layer.msg("修改成功",{icon: 1,time: 2000});                            renderTable();                            layui.layer.close(index);                        }                    }                })            }        });    }}$(function () {    //调用父级页面的Js函数    window.parent.getJointVisitPath();})