<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <link href="/mp/common/layui/css/layui.css" rel="stylesheet">
    <link href="/mp/css/mp.css?v=21212" rel="stylesheet">
</head>
<body>
    <!-- ç»Ÿè®¡å›¾è¡¨  -->

    <div class="layui-container" style="width: 90%;margin-top: 30px;">

        <div class="layui-row layui-col-space15">

        
            <!-- è®¿é—®é‡ç»Ÿè®¡ -->
   
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header" data-locale="sum_today">ä»Šæ—¥è®¿é—®é‡</div>
                    <div class="layui-card-body layuiadmin-card-list">
                        <p class="layuiadmin-big-font" id="todayVisitrNum">0</p>
                    </div>
                </div>
            </div>

            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header" data-locale="sum_visits">ç´¯è®¡è®¿é—®é‡</div>
                    <div class="layui-card-body layuiadmin-card-list">
                        <p class="layuiadmin-big-font" id="sumVisitrNum">0</p>
                    </div>
                </div>
            </div>


            <!-- å…¨å±€æ—¶é—´èŒƒå›´é€‰æ‹© -->
            <div class="layui-col-sm12" style="margin: 72px 0px -1px 0px;">
                <div class="layui-card" >
                    <div class="layui-card-header" style="height: 55px;">
                        <div class="layui-form" style="min-width: 400px;max-height: 30px;display: inline-flex; margin-top: 8px;">

                            <div class="layui-form-item">
                                <div class="layui-inline">
                                  <label class="layui-form-label" style="padding: 9px 8px" data-locale="time_socpe">æ—¶é—´èŒƒå›´ï¼š</label>
                                  <div class="layui-input-inline">
                                    <input class="layui-input" id="visitorCountDate" placeholder=" - " type="text">
                                  </div>
                                </div>
                            </div>
                            <div class="layui-form-item" >

                                <div class="layui-inline" >
                                      <div class="layui-input-inline" style="width: 80px;">
                                        <select class="visitorCount_time_unit" name="timeItem"  lay-filter="visitorCount_time_unit">
                                                <option value="1" data-locale="time_unit_month">æœˆ</option>
                                                <option value="2" data-locale="time_unit_day" selected>å¤©</option>
                                                <option value="3" data-locale="time_unit_hour">å°æ—¶</option>
                                         </select>
                                      </div>
                                </div>


                                <div class="layui-inline" >
                                    <span style="color: red;" class="prompt_info"></span>
                                </div>


                            </div>



                        </div>


                    </div>
                </div>
            </div>
                

            <!-- æ¯æ—¥è®¿å®¢ç»Ÿè®¡å›¾å±•ç¤º -->
            <div class="layui-col-sm12">
                <div class="layui-card">
                    <div class="layui-card-body">
                        <div class="layui-row">
                            <div class="layui-col-sm12">
                                <div class="layui-carousel layadmin-carousel layadmin-dataview" data-anim="fade" lay-filter="LAY-index-pagetwo" lay-anim="fade" style="width: 100%; ">
                                    <div id="everyDayVisitorCount"  style="width:100%;height:300px;"></div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <!-- æ—¶é—´èŒƒå›´æœç´¢ -->
            <div class="page_content">
                <table class="layui-table" style="margin-top: 30px;">
                    <thead>
                    </thead>
                    <tbody id="service_back_td">
                    </tbody>
                </table>
            </div>

            <!-- å®¢æœæ¥å¾…è®¿å®¢æ’åç»Ÿè®¡å›¾å±•ç¤º -->
            <div id="serviceRanking" style="width: 90%;height:600px;float:left;"></div>

        </div>
    </div>

    <!-- è¡¨æ ¼æ“ä½œåˆ— -->
	<script type="text/html" id="replyMenuBar">
	    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit">æ·»åŠ å­èœå•</a>
	    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">åˆ é™¤</a>
	</script>

    <script type="text/javascript" src="/mp/common/layui/layui.all.js"></script>
    <script type="text/javascript" src="/mp/common/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="/mp/common/jquery/jquery.md5.js"></script>


    <!-- i18nå›½é™…åŒ– -->
    <script type="text/javascript" src="/mp/common/i18n/jquery.i18n.properties.js"></script>

    <script type="text/javascript" src="/mp/common/echarts/echarts4_7_0.js"></script>
    <script type="text/javascript" src="/mp/common/echarts/shine.js"></script>


    <script type="text/javascript" src="/mp/js/mp_commons.js"></script>
    
    <script>
        var CustomerCount = {

            //è·å–æ¯æ—¥è®¿å®¢ æŠ˜çº¿å›¾
            getVisitorCount(startDate,endDate,timeUnit){
                var userRegister = echarts.init(document.getElementById('everyDayVisitorCount'),'shine');
                mpCommon.invoke2({
                    url : '/customerService/admin/visitorCount',
                    data : {
                        startDate:startDate,
                        endDate:endDate,
                        timeUnit:timeUnit
                    },
                    success : function(result) {
                        if(result.resultCode==1){
                            var optionchartZhe = {
                                title: {
                                    text : mpLanguage.getLanguageName('visitor_statistics')
                                },
                                tooltip : { trigger : 'axis'},
                                /*legend: {
                                    data: ['æ¯æ—¥è®¿å®¢']
                                },*/
                                xAxis: {
                                    // type: 'category',
                                    // boundaryGap: false, //ä»èµ·ç‚¹å¼€å§‹
                                    data: CustomerCount.getTimeStr(result.data)
                                },
                                yAxis: {
                                    splitLine: {
                                        show: false
                                    },
                                    type: 'value'
                                },
                                /*toolbox: {
                                    left: 'right',
                                    feature: {
                                        dataZoom: {
                                            yAxisIndex: 'none'
                                        },
                                        restore: {},
                                        //saveAsImage: {}
                                    }
                                },*/
                                visualMap: {
                                    top: 10,
                                    right: 10,
                                    pieces: [{
                                        gt: 0,
                                        lte: 50,
                                        color: '#096'
                                    }, {
                                        gt: 50,
                                        lte: 100,
                                        color: '#ffde33'
                                    }, {
                                        gt: 100,
                                        lte: 150,
                                        color: '#ff9933'
                                    }, {
                                        gt: 150,
                                        lte: 200,
                                        color: '#cc0033'
                                    }, {
                                        gt: 200,
                                        lte: 300,
                                        color: '#660099'
                                    }, {
                                        gt: 300,
                                        color: '#7e0023'
                                    }],
                                    outOfRange: {
                                        color: '#999'
                                    }
                                },
                                series: [{
                                    name: mpLanguage.getLanguageName('daily_visitors'),
                                    type: 'line', //çº¿æ€§
                                    data: CustomerCount.getTimeVlues(result.data)
                                }]
                            };

                            userRegister.setOption(optionchartZhe, true);
                        }
                    },
                    error : function(result) {
                        layer.msg(result.resultMsg,{"icon":5});
                    }
                });
            }
            //è·å–ä»Šæ—¥è®¿å®¢æ•°  ä¸  æ€»è®¿å®¢æ•°
            ,getCountCustomVisitrNum() {
                mpCommon.invoke2({
                    url : '/customerService/admin/countCustomTodayVisitrNum',
                    data : {},
                    success : function(result) {
                        if(result.resultCode==1){
                            $("#todayVisitrNum").html(result.data.todayVisitrNum);
                            $("#sumVisitrNum").html(result.data.sumVisitrNum);
                        }
                    },
                    error : function(result) {
                        layer.msg(result.resultMsg,{"icon":5});
                    }
                });
            },
            //è·å–å®¢æœæ¥å¾…è®¿å®¢æ•°æ’å
            getServiceRanking(){
                var serviceRanking_chart = echarts.init(document.getElementById('serviceRanking'));

                mpCommon.invoke2({
                    url : '/customerService/admin/getServiceRanking',
                    data : {},
                    success : function(result) {
                        if (result.resultCode == 1){
                            var data = result.data;


                            serviceRanking_chart.setOption( {
                                title: {
                                    text: mpLanguage.getLanguageName('service_visitor_num'),
                                    subtext: mpLanguage.getLanguageName('ranking')
                                },
                                tooltip: {
                                    trigger: 'axis',
                                    axisPointer: {
                                        type: 'shadow'
                                    }
                                },
                                legend: {
                                    data: [mpLanguage.getLanguageName('numberOf')]
                                },
                                color: ['#c12e34', '#c12e34'],
                                grid: {
                                    containLabel: true
                                },
                                xAxis: {
                                    type: 'value',
                                    boundaryGap: [0, 0.01]
                                },
                                yAxis: {
                                    type: 'category',
                                    data: CustomerCount.getTimeStr(data)
                                },
                                series: [
                                    {
                                        name: mpLanguage.getLanguageName('numberOf'),
                                        type: 'bar',
                                        data: CustomerCount.getTimeVlues(data)
                                    }
                                ]
                            });


                            /*option = {
                                color: ['#c12e34'],
                                tooltip: {
                                    trigger: 'axis',
                                    axisPointer: {            // åæ ‡è½´æŒ‡ç¤ºå™¨ï¼Œåæ ‡è½´è§¦å‘æœ‰æ•ˆ
                                        type: 'shadow'        // é»˜è®¤ä¸ºç›´çº¿ï¼Œå¯é€‰ä¸ºï¼š'line' | 'shadow'
                                    }
                                },
                                grid: {
                                    left: '3%',
                                    right: '4%',
                                    bottom: '3%',
                                    containLabel: true
                                },
                                xAxis: [
                                    {
                                        type: 'category',
                                        data: ['å®¢æœè‹¥æ›¦', 'ä½ åœ¨æ•™æˆ‘åšäº‹', 'ä¼°è®¡å¯„å‡ å—å¯å“¦è‹¦èŠä¸ªä¸èƒ½æ²¡æ²¡æ²¡å¸®ä½ ä»¬å¦ˆå¦ˆå®¶ä½ é‚£è¾¹ğŸ˜­å¥½çœ‹äº†', 'å¯Œå©†éƒ½æƒ³åŒ…å…»æˆ‘', 'è€è¡²å››å¤§çš†ç©ºï¼Œåªçˆ±é’±å’Œç¾å¥³', 'å®¢æœç‹ä¿Šå‡¯', 'å®¢æœtest111'],
                                        axisTick: {
                                            alignWithLabel: true
                                        },
                                        axisLabel:{
                                              interval: 0,
                                              formatter: function (value) {
                                                //xè½´çš„æ–‡å­—æ”¹ä¸ºç«–ç‰ˆæ˜¾ç¤º
                                                var str = value.split("");
                                                return str.join("\n");
                                              }
                                            },
                                    }
                                ],
                                yAxis: [
                                    {
                                        type: 'value'
                                    }
                                ],
                                series: [
                                    {
                                        name: 'ç›´æ¥è®¿é—®',
                                        type: 'bar',
                                        barWidth: '60%',
                                        data: [10, 52, 200, 334, 390, 330, 220]
                                    }
                                ]
                            };*/



                        }
                    },
                    error : function(result) {
                        layer.msg(result.resultMsg,{"icon":5});
                    }
                });

            
            },
            getTimeStr(datas){
                var timeStrs = new Array();
                for(var time in datas){
                  timeStrs.push(time);
                }
                return timeStrs;
            }
            ,getTimeVlues(datas){
                var values = new Array();
                for(var time in datas){
                    values.push(datas[time]);
                }
                return values;
            },
            listenDateSwitch : function(){
                //æ—¥æœŸèŒƒå›´
                var time =  layui.laydate.render({
                    elem: '#visitorCountDate'
                    ,lang: mpLanguage.getLanguage()
                    ,range: "~"
                    ,done: function(value, date, endDate){  // choose end
                        //console.log("date callBack====>>>"+value); //å¾—åˆ°æ—¥æœŸç”Ÿæˆçš„å€¼ï¼Œå¦‚ï¼š2017-08-18
                        var startDate = value.split("~")[0];
                        var endDate = value.split("~")[1]; 
                        var timeUnit =  $(".visitorCount_time_unit").val();

                        CustomerCount.getVisitorCount(startDate,endDate,timeUnit);
                    }
                    ,max: 0
                });


                //æ—¶é—´å•ä½åˆ‡æ¢
                layui.form.on('select(visitorCount_time_unit)', function(data){

                    if(data.value==3){ //æ—¶é—´å•ä½åˆ‡æ¢åˆ°å°æ—¶

                        $("#visitorCountDate").val("");

                        $("#visitorCountDate").attr("disabled","");
                        //getLanguage('count_hint')
                        $(".prompt_info").text(mpLanguage.getLanguageName("count_hint"));

                        dateRange = "";

                    } else {

                        $("#visitorCountDate").removeAttr("disabled");
                        $(".prompt_info").text("");
                    }

                      var dateRange = $("#visitorCountDate").val();
                      var startDate = dateRange.split("~")[0];
                      var endDate = dateRange.split("~")[1];
                      CustomerCount.getVisitorCount(startDate,endDate,data.value);
                });
            },

            
            
        };


        layui.use(['layer','table','laydate'],function(){
            var layer = parent.layer === undefined ? layui.layer : top.layer,
                $ = layui.jquery,
                table = layui.table;

            CustomerCount.listenDateSwitch();

            CustomerCount.getVisitorCount("","",2);
            CustomerCount.getCountCustomVisitrNum();
            CustomerCount.getServiceRanking();
        });

       




    </script>





</body>
</html>
